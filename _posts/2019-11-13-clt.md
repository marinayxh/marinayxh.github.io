---
title: "Simulation Study: CLT"
date: 2019-11-13
permalink: /clt-sim/
excerpt: "Simulation Study"
---


## Introduction


The central limit theorem is an important computational short-cut for generating and making inference from the sampling distribution of the mean. The central limit theorem short-cut relies on a number of conditions, specifically:

1. Independent observations
2. Identically distributed observations
3. Mean and variance exist
4. Sample size large enough for convergence

In this simulation study, you are going to compare the sampling distribution of the mean generated by simulation to the sampling distribution implied by the central limit theorem. You will compare the distributions graphically in QQ-plots.

Requirement:

1. 4 × 4 factorial experiment. 
2. N = 5, 10, 20, and 40. 
3. slant will be set to 0, 2, 10, 100. 
4. Set location and scale to 0 and 1.
5. R = 5000.

When analyzing data, the parameters for the mean and variance (in the case of the CLT shortcut) or the parameters for the distribution (in the case of MLE, MM, etc.) are replaced with sample estimates. (This is often called the plug-in approach.) For the purposes of this simulation, treat the mean and variance as known values and use the actual population parameters and the population mean and variance instead of sample estimates.

```r
# parameters
R <- 5000
location <- 0
scale <- 1
N <- c(5,10,20,40)
slant <- c(0,2,10,100)


# generate cases
generated <- function(slant, N, location, scale, R){
  
  delta <- slant/(sqrt(1+slant^2))
  # Quanites to calculate/generate
  pop_mean <- location+scale*delta*(sqrt(2/pi))
  pop_sd <- sqrt(scale^2*(1-((2*delta^2)/pi)))
    
  Z <- rnorm(R)
  sample_dist_clt <- Z*(pop_sd/sqrt(N))+pop_mean
  
  random_skew <- array(rsn(R*N, xi = location, omega = scale, alpha = slant),dim = c(R,N))
  
  sample_dist_sim <- apply(random_skew,1,mean)
  
  # QQ plot
  qqplot(sample_dist_sim,sample_dist_clt,asp=1, axes = FALSE, frame.plot=TRUE, ann = FALSE)
  abline(0,1)
}
```

```{r}
# set up the qq plot
labels <- c("N = 5", "N = 10", "N = 20", "N = 40")
x <- seq(from = -4, to = 4, by = 0.05) 

par(mfrow = c(4,5), mai=c(0.1,0.1,0.1,0.1), oma = c(0, 4, 4, 0))

# plotting
for(s in slant){
  plot(dsn(x, omega = scale, xi = location, alpha = s), type = "l", ylab = paste0("slant  = ", s), axes = FALSE, frame.plot=TRUE)
  for(n in N){
    generated(slant = s, N = n, location = 0, scale = 1, R = 5000)
  }
}

# set text
mtext('slant = 100        slant = 10        slant = 2        slant = 0'
      , side = 2, outer = TRUE)
mtext('Distribution            N = 5                   N = 10                  N = 20                   N = 40'
      , side = 3, outer = TRUE)
dev.copy(png, "plot.png", , width=500, height=350)
dev.off()
```
![](/images/clt1.PNG)

Here we see that while the N is increasing, more points fall on the reference line. From the first type of distribution, when the slant parameter is 0, the distribution reverts to the normal distribution. As the slant parameter increases, the distribution becomes increasingly skewed. We can also tell the direction of the tail when N is small. Distributions with large slant skew to the right which are also shown on the related qqplot (tails below the reference line). However, since the number of sample size raises, the qqplot is more likely to show as with a normal distribution. 

The central limit theorem states that if you have a population with mean μ and standard deviation σ and take sufficiently large random samples from the population with replacement , then the distribution of the sample means will be approximately normally distributed. 

The mean of a sample of data will be closer to the mean of the overall population, as the sample size increases. In other words, the data is accurate whether the distribution is normal or aberrant.